import time
from web3 import Web3, HTTPProvider
import json
import requests
w3 = Web3(HTTPProvider("http://localhost:8545"))
w3.eth.defaultAccount = w3.eth.accounts[0]
with open('../contract/contract_abi.json', 'r') as abi_definition:
    abi = json.load(abi_definition)
bytecode = "608060405234801561001057600080fd5b50610673806100206000396000f3fe608060405234801561001057600080fd5b5060043610610069576000357c0100000000000000000000000000000000000000000000000000000000900480639f9d57931461006e578063bfe370d914610112578063c0f8940c146101e1578063e00413961461022b575b600080fd5b6100d06004803603606081101561008457600080fd5b81019080803590602001909291908035906020019092919080357effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff19169060200190929190505050610373565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6101cb6004803603602081101561012857600080fd5b810190808035906020019064010000000081111561014557600080fd5b82018360208201111561015757600080fd5b8035906020019184600183028401116401000000008311171561017957600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610430565b6040518082815260200191505060405180910390f35b6101e961043e565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b6102f86004803603606081101561024157600080fd5b810190808035906020019064010000000081111561025e57600080fd5b82018360208201111561027057600080fd5b8035906020019184600183028401116401000000008311171561029257600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290803590602001909291908035906020019092919050505061050d565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561033857808201518184015260208101905061031d565b50505050905090810190601f1680156103655780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b600080601b837f0100000000000000000000000000000000000000000000000000000000000000900401905060018186866040516000815260200160405260405180807f4e03657aea45a94fc7d47ba826c8d667c0d1e6e33a64a036ec44f58fa12d6c458152506020018460ff1660ff16815260200183815260200182815260200193505050506020604051602081039080840390855afa15801561041c573d6000803e3d6000fd5b505050602060405103519150509392505050565b600060208201519050919050565b60006060608060405190810160405280604181526020016106076041913990506000610475610470836000602061050d565b610430565b9050600061048d6104888460208061050d565b610430565b9050600061049e846040600161050d565b60008151811015156104ac57fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f0100000000000000000000000000000000000000000000000000000000000000029050610504838383610373565b94505050505090565b606080826040519080825280601f01601f1916602001820160405280156105435781602001600182028038833980820191505090505b50905060008090505b838110156105fa578585820181518110151561056457fe5b9060200101517f010000000000000000000000000000000000000000000000000000000000000090047f01000000000000000000000000000000000000000000000000000000000000000282828151811015156105bd57fe5b9060200101907effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916908160001a905350808060010191505061054c565b5080915050939250505056fef4128988cbe7df8315440adde412a8955f7f5ff9a5468a791433727f82717a6753bd71882079522207060b681fbd3f5623ee7ed66e33fc8e581f442acbcf6ab800a165627a7a723058201b43bfb9e2acde9c6f97bae1a5510ca0f05abe244a2708c6286d511667be86690029"
session = requests.Session()
payload = {"jsonrpc": "2.0",
           "method": 'personal_unlockAccount',
           "params": [w3.eth.defaultAccount, "0xa9436991e002986f58d948d79e737df190c4f26b"],
           "id": 1}
headers = {'Content-type': 'application/json'}
response = session.post('http://localhost:8545', json=payload, headers=headers)
print(response.json())
Greeter = w3.eth.contract(abi=abi, bytecode=bytecode)
tx_hash = Greeter.constructor().transact()
tx_receipt = w3.eth.waitForTransactionReceipt(tx_hash)
greeter = w3.eth.contract(
    address=tx_receipt.contractAddress,
    abi=abi
)
greeter.functions.greet().call()
